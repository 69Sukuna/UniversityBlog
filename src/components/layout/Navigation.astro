---
const pathname = Astro.url.pathname;

const navItems = [
  { name: 'Inicio', href: '/' },
  { 
    name: 'Sociedades Científicas Parte 1', 
    href: '/',
    children: [
      { 
        name: 'So.C.E. Ing. Minas', 
        href: '/sociedades/Min' 
      },
      { 
        name: 'So.C.E. Ing. Civil', 
        href: '/sociedades/Civ' 
      },
      { 
        name: 'So.C.E. Ing. Metalurgia y Materiales', 
        href: '/sociedades/MetMat' 
      },
      { 
        name: 'So.C.E. Ing. Mecánica Electromecánica Mecatrónica', 
        href: '/',
        children: [
          { name: 'So.C.E. SCEIMEM', href: '/sociedades/Mec' },
          { name: 'Sub-sociedad COM', href: '/sociedades/COM' },
          { name: 'Sub-sociedad SIDDFAC', href: '/sociedades/SIDDFAC' }
        ]
      },
      { 
        name: 'So.C.E. Ing. Eléctrica - Ing. Electrónica', 
        href: '/sociedades/Elec' 
      },
      { 
        name: 'So.C.E. Ing. Química e Ing. de Alimentos', 
        href: '/sociedades/Quim' 
      },
    ]
  },
  {
    name: 'Sociedades Científicas Parte 2',
    href: '/',
    children: [
      { 
        name: 'So.C.E. Ing. Geológica', 
        href: '/sociedades/Geo' 
      },
      { 
        name: 'So.C.E. Ing. de Sistemas e Ing. Informática', 
        href: '/sociedades/SISinf' 
      },
      { 
        name: 'So.C.E. Ing. Industrial', 
        href: '/sociedades/Ind' 
      },
      { 
        name: 'So.C.E. del Departamento de Física de Ciclo Básico', 
        href: '/sociedades/Fis' 
      },
      { 
        name: 'So.C.E. del Departamento de Química', 
        href: '/sociedades/Cons' 
      },
    ]
  },
  { name: 'Noticias', href: '#noticias' },
  { name: 'Autoridades - Directiva', href: '#direc' },
  { name: 'Enlaces', href: '#enlaces' }
];
---

<nav class="hidden md:flex flex-col space-y-2">
  {
    navItems.map((item) => (
      <div class="relative nav-item">
        <a
          href={item.href}
          class={`block px-4 py-2 rounded-md text-base font-medium transition-colors duration-200 ${
            pathname === item.href || (item.href !== '/' && pathname.startsWith(item.href))
              ? 'text-blue-600 bg-blue-50'
              : 'text-gray-700 hover:text-gray-900 hover:bg-gray-50'
          }`}
        >
          {item.name}
          {item.children && (
            <svg 
              class="inline-block ml-1 w-4 h-4 transition-transform duration-200" 
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          )}
        </a>
        
        {item.children && (
          <div class="submenu-level-1">
            <div class="py-2">
              {item.children.map((child) => (
                <div class="submenu-item relative">
                  <a
                    href={child.href}
                    class={`submenu-link flex items-center justify-between px-4 py-3 text-sm transition-colors duration-200 ${
                      pathname === child.href
                        ? 'text-blue-600 bg-blue-50'
                        : 'text-gray-700 hover:text-gray-900 hover:bg-gray-50'
                    }`}
                    onclick={child.href.startsWith('#') ? `document.getElementById('${child.href.substring(1)}')?.scrollIntoView({behavior: 'smooth', block: 'start'}); return true;` : ''}
                  >
                    <span>{child.name}</span>
                    {child.children && (
                      <svg 
                        class="w-4 h-4 ml-2 text-gray-400 flex-shrink-0" 
                        fill="none" 
                        stroke="currentColor" 
                        viewBox="0 0 24 24"
                      >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                      </svg>
                    )}
                  </a>
                  
                  {/* SUBMENU ANIDADO - TERCER NIVEL */}
                  {child.children && (
                    <div class="submenu-level-2">
                      <div class="py-2">
                        <div class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider border-b border-gray-100 mb-1 bg-gray-50">
                          {child.name}
                        </div>
                        {child.children.map((grandchild) => (
                          <a
                            href={grandchild.href}
                            class={`block px-4 py-2 text-sm transition-colors duration-200 ${
                              pathname === grandchild.href
                                ? 'text-blue-600 bg-blue-50'
                                : 'text-gray-700 hover:text-gray-900 hover:bg-gray-50'
                            }`}
                          >
                            {grandchild.name}
                          </a>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    ))
  }
</nav>

<!-- CSS puro para submenu anidado -->
<style>
  html {
    scroll-behavior: smooth;
  }
  
  .scroll-section {
    scroll-margin-top: 100px;
    padding-top: 20px;
  }
  
  /* Submenu nivel 1 */
  .submenu-level-1 {
    position: absolute;
    left: 0;
    top: 100%;
    margin-top: 4px;
    width: 320px;
    background: white;
    border-radius: 6px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    border: 1px solid #e5e7eb;
    z-index: 50;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease-in-out;
  }
  
  .nav-item:hover .submenu-level-1 {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  /* Submenu nivel 2 */
  .submenu-level-2 {
    position: absolute;
    left: 100%;
    top: 0;
    margin-left: 8px;
    width: 256px;
    background: white;
    border-radius: 6px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    border: 1px solid #e5e7eb;
    z-index: 60;
    opacity: 0;
    visibility: hidden;
    transform: translateX(-10px);
    transition: all 0.2s ease-in-out;
    transition-delay: 0.1s;
  }
  
  .submenu-item:hover .submenu-level-2 {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
  }
  
  /* Mantener visible cuando hover sobre el submenu */
  .submenu-level-1:hover,
  .submenu-level-2:hover {
    opacity: 1;
    visibility: visible;
  }
  
  /* Prevenir que se cierre al mover entre elementos */
  .nav-item:hover .submenu-level-1,
  .submenu-level-1:hover {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .submenu-item:hover .submenu-level-2,
  .submenu-level-2:hover {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
  }
</style>

<!-- Script simple solo para debug -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    console.log('=== DEBUG SCROLL ===');
    console.log('Elemento #enlaces existe:', !!document.getElementById('enlaces'));
    console.log('Elemento #services existe:', !!document.getElementById('services'));
    console.log('Elemento #footer existe:', !!document.getElementById('footer'));
    console.log('Elemento #location existe:', !!document.getElementById('location'));
    
    const elementsWithId = document.querySelectorAll('[id]');
    console.log('Todos los elementos con ID:');
    elementsWithId.forEach(el => {
      console.log(`- ${el.id}: ${el.tagName}`);
    });
    
    console.log('Submenu configurado con CSS puro - no requiere JavaScript');
  });
</script>